# Working with Import Set API in ServiceNow

[[Overview]](#overview)  [[Operation details]](#operation-details)  [[Sample configuration]](#sample-configuration)

### Overview 

The following operations allow you to work with  Import Set API. Click an operation name to see details on how to use it.
For a sample proxy service that illustrates how to work with  Import Set API, see [Sample configuration](#sample-configuration).

| Operation        | Description |
| ------------- |-------------|
| [getRecordsStagingTable](#retrieving-the-associated-record)    | This method retrieves the associated record and resulting transformation result. |
| [queryEventMonitoringData](#Inserts-incoming-data-into-a-specified-staging-table)      | This method inserts incoming data into a specified staging table and triggers transformation based on predefined transform maps in the import set table. |

### Operation details

This section provides more details on each of the operations related to Import Set API.

#### Retrieving the associated record

The getRecordStagingTable operation retrieves the associated record and resulting transformation result.

**getRecordsStagingTable**
```xml
<servicenow.getRecordsStagingTable>
    <tableNameStaging>{$ctx:tableNameStaging}</tableNameStaging>
    <sysIdStaging>{$ctx:sysIdStaging}</sysIdStaging>
</servicenow.getRecordsStagingTable>
```
**Properties**

* tableNameStaging :  Name of the staging table you want to retrieve records.
* sysIdStaging :  The Id which is automatically generated by ServiceNow. It is unique value for each record.

**Sample request**

Following is a sample request that can be handled by the getRecordsStagingTable operation.

```json

{
  "serviceNowInstanceURL":"https://dev17686.service-now.com",
  "username":"admin",
  "password":"12345",
  "tableNameStaging":"imp_computer",
  "serialNumber":"282",
  "cpuCount":"234",
  "name":"Mac",
  "operatingSystem":"ubunthu",
  "manufacturer":"IBM",
  "diskSpace":"400Gb",
  "ram":"ram 1500",
  "apiColumns": {"sys_mod_count":"2","sys_import_state_comment":"wwww"}
}
```
**Sample response**

Given below is a sample response for the getRecordsStagingTable operation.

```json
{
   "import_set":"ISET0010001",
   "staging_table":"imp_computer",
   "result":[
      {
         "transform_map":"Computer",
         "table":"cmdb_ci_computer",
         "display_name":"name",
         "display_value":"Mac",
         "record_link":"https://dev17686.service-now.com/api/now/table/cmdb_ci_computer/201bea46dbb033004f281120399619c1",
         "status":"inserted",
         "sys_id":"201bea46dbb033004f281120399619c1",
         "status_message":"wwww"
      }
   ]
}
```

**Related ServiceNow documentation**

https://developer.servicenow.com/app.do#!/rest_api_doc?v=jakarta&id=r_ImportSetAPI-GET

#### Inserts incoming data into a specified staging table

To retrieve the field values from a record, use salesforcerest.queryEventMonitoringData and specify the following properties.

**postRecordStagingTable**
```xml
<servicenow.postRecordStagingTable>
    <tableNameStaging>{$ctx:tableNameStaging}</tableNameStaging>
    <serialNumber>{$ctx:serialNumber}</serialNumber>
    <cpuCount>{$ctx:cpuCount}</cpuCount>
    <manufacturer>{$ctx:manufacturer}</manufacturer>
    <name>{$ctx:name}</name>
    <operatingSystem>{$ctx:operatingSystem}</operatingSystem>
    <diskSpace>{$ctx:diskSpace}</diskSpace>
    <ram>{$ctx:ram}</ram>
   <apiColumns>{$ctx:apiColumns}</apiColumns>
 </servicenow.postRecordStagingTable>
```
**Properties**
* tableNameStaging :  Name of the staging table you want to retrieve records..
* serialNumber :  This is an attribute in the table. Specify the row value for serialNumber .
* cpuCount : This is an attribute in the table. Specify the row value for cpuCount .
* manufacturer :  This is an attribute in the table. Specify the row value for manufacturer.  
* name: This is an attribute in the table. Specify the row value for name.
* operatingSystem: This is an attribute in the table. Specify the row value for operatingSystem .
* diskSpace: This is an attribute in the table. Specify the row value for diskSpace .
* ram: This is an attribute in the table. Specify the row value for ram. 
* apiColumns : The attribute values of your table in your instance.


**Sample request**

Following is a sample request that can be handled by the postRecordStagingTable operation.

```json
{
  "serviceNowInstanceURL":"https://dev17686.service-now.com",
  "username":"admin",
  "password":"12345",
  "tableNameStaging":"imp_computer",
  "serialNumber":"282",
  "cpuCount":"234",
  "name":"Mac",
  "operatingSystem":"ubunthu",
  "manufacturer":"IBM",
  "diskSpace":"400Gb",
  "ram":"ram 1500",
  "apiColumns": {"sys_mod_count":"2","sys_import_state_comment":"wwww"}
}
```
**Sample response**

Given below is a sample response for the postRecordStagingTable operation.

```json
{
   "import_set":"ISET0010001",
   "staging_table":"imp_computer",
   "result":[
      {
         "transform_map":"Computer",
         "table":"cmdb_ci_computer",
         "display_name":"name",
         "display_value":"Mac",
         "record_link":"https://dev62519.service-now.com/api/now/table/cmdb_ci_computer/201bea46dbb033004f281120399619c1",
         "status":"ignored",
         "sys_id":"201bea46dbb033004f281120399619c1",
         "status_message":"wwww;No field values changed"
      }
   ]
}
```

**Related ServiceNow documentation**

https://developer.servicenow.com/app.do#!/rest_api_doc?v=jakarta&id=r_ImportSetAPI-POST

**NOTE**

You have to give Access Control List (ACL) permission to access the records in import set tables. You can find more information on http://wiki.servicenow.com/index.php?title=REST_API#gsc.tab=0

### Sample configuration

Following example illustrates how to connect to ServiceNow with the init operation and getRecordsStagingTable operation.

1. Create a sample proxy as below :

```xml
<proxy xmlns="http://ws.apache.org/ns/synapse"
       name="getRecordsStagingTable"
       transports="https,http"
       statistics="disable"
       trace="disable"
       startOnLoad="true">
   <target>
      <inSequence>
         <property name="serviceNowInstanceURL" expression="json-eval($.serviceNowInstanceURL)"/>
         <property name="username" expression="json-eval($.username)"/>
         <property name="password" expression="json-eval($.password)"/>
         <property name="tableNameStaging" expression="json-eval($.tableNameStaging)"/>
         <property name="sysIdStaging" expression="json-eval($.sysIdStaging)"/>
         <servicenow.init>
            <serviceNowInstanceURL>{$ctx:serviceNowInstanceURL}</serviceNowInstanceURL>
            <username>{$ctx:username}</username>
            <password>{$ctx:password}</password>
         </servicenow.init>
         <servicenow.getRecordsStagingTable>
            <tableNameStaging>{$ctx:tableNameStaging}</tableNameStaging>
            <sysIdStaging>{$ctx:sysIdStaging}</sysIdStaging>
         </servicenow.getRecordsStagingTable>
         <respond/>
      </inSequence>
      <outSequence>
         <log/>
         <send/>
      </outSequence>
   </target>
   <description/>
</proxy>
```

2. Create a JSON file named getRecordsStagingTable.json and add the configurations given below:

```json
{
  "serviceNowInstanceURL":"https://dev17686.service-now.com",
  "username":"admin",
  "password":"12345",
  "tableNameStaging":"imp_computer",
  "serialNumber":"282",
  "cpuCount":"234",
  "name":"Mac",
  "operatingSystem":"ubunthu",
  "manufacturer":"IBM",
  "diskSpace":"400Gb",
  "ram":"ram 1500",
  "apiColumns": {"sys_mod_count":"2","sys_import_state_comment":"wwww"}
}
```
3. Replace the credentials with your values.

4. Execute the following curl command:

```bash
curl http://localhost:8280/services/getRecordsStagingTable -H "Content-Type: application/json" -d @getRecordsStagingTable.json
```

5. ServiceNow returns a JSON response similar to the one shown below:
 
```json
{
   "import_set":"ISET0010001",
   "staging_table":"imp_computer",
   "result":[
      {
         "transform_map":"Computer",
         "table":"cmdb_ci_computer",
         "display_name":"name",
         "display_value":"Mac",
         "record_link":"https://dev17686.service-now.com/api/now/table/cmdb_ci_computer/201bea46dbb033004f281120399619c1",
         "status":"inserted",
         "sys_id":"201bea46dbb033004f281120399619c1",
         "status_message":"wwww"
      }
   ]
}
```
